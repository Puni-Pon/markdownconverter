<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to Confluence Converter</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f9fafb;
        }
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }
        .header p {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        .panel {
            width: 50%;
            background: white;
            display: flex;
            flex-direction: column;
        }
        .panel-left {
            border-right: 1px solid #e5e7eb;
        }
        .panel-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .panel-header h2 {
            font-weight: 600;
            color: #374151;
        }
        .button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .button-clear {
            background: #f3f4f6;
            color: #374151;
        }
        .button-clear:hover {
            background: #e5e7eb;
        }
        .button-primary {
            background: #2563eb;
            color: white;
        }
        .button-primary:hover {
            background: #1d4ed8;
        }
        .button-mode {
            background: #f3f4f6;
            color: #374151;
        }
        .button-mode.active {
            background: #2563eb;
            color: white;
        }
        .button-mode:hover:not(.active) {
            background: #e5e7eb;
        }
        .mode-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .upload-section {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .upload-area:hover {
            border-color: #2563eb;
            background: #eff6ff;
        }
        .upload-area.drag-over {
            border-color: #2563eb;
            background: #dbeafe;
        }
        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .upload-text {
            color: #6b7280;
            font-size: 0.875rem;
        }
        .file-input {
            display: none;
        }
        .file-list {
            margin-top: 1rem;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }
        .file-item.selected {
            background: #dbeafe;
            border-color: #2563eb;
        }
        .file-name {
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            flex: 1;
        }
        .file-remove {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            border: none;
        }
        .file-remove:hover {
            background: #dc2626;
        }
        textarea {
            flex: 1;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            border: none;
            resize: none;
            outline: none;
        }
        .output-area {
            flex: 1;
            padding: 1rem;
            overflow: auto;
        }
        .output-source {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .output-preview h1 { font-size: 1.875rem; font-weight: bold; margin-bottom: 1rem; }
        .output-preview h2 { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.75rem; }
        .output-preview h3 { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; }
        .output-preview h4 { font-size: 1.125rem; font-weight: bold; margin-bottom: 0.5rem; }
        .output-preview h5 { font-size: 1rem; font-weight: bold; margin-bottom: 0.25rem; }
        .output-preview h6 { font-size: 0.875rem; font-weight: bold; margin-bottom: 0.25rem; }
        .output-preview pre {
            background: #1f2937;
            color: #10b981;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            overflow-x: auto;
        }
        .output-preview code {
            background: #e5e7eb;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        .output-preview pre code {
            background: transparent;
            padding: 0;
        }
        .output-preview strong { font-weight: bold; }
        .output-preview em { font-style: italic; }
        .output-preview del { text-decoration: line-through; }
        .output-preview a {
            color: #2563eb;
            text-decoration: underline;
        }
        .output-preview img {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
        }
        .output-preview ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .output-preview ol {
            list-style-type: decimal;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .output-preview li {
            margin-bottom: 0.25rem;
        }
        .output-preview blockquote {
            border-left: 4px solid #9ca3af;
            padding-left: 1rem;
            font-style: italic;
            margin: 1rem 0;
        }
        .output-preview hr {
            margin: 1rem 0;
            border: none;
            border-top: 1px solid #d1d5db;
        }
        .output-preview p {
            margin-bottom: 1rem;
        }
        .placeholder {
            color: #9ca3af;
        }
        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .download-all {
            background: #059669;
            color: white;
        }
        .download-all:hover {
            background: #047857;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef } = React;

        const MarkdownToConfluence = () => {
            const [markdown, setMarkdown] = useState('');
            const [files, setFiles] = useState([]);
            const [selectedFileIndex, setSelectedFileIndex] = useState(null);
            const [viewMode, setViewMode] = useState('source');
            const [inputMode, setInputMode] = useState('text'); // 'text' or 'files'
            const [copied, setCopied] = useState(false);
            const [dragOver, setDragOver] = useState(false);
            const fileInputRef = useRef(null);

            const convertToConfluence = (md) => {
                let confluence = md;

                confluence = confluence.replace(/^######\s+(.+)$/gm, 'h6. $1');
                confluence = confluence.replace(/^#####\s+(.+)$/gm, 'h5. $1');
                confluence = confluence.replace(/^####\s+(.+)$/gm, 'h4. $1');
                confluence = confluence.replace(/^###\s+(.+)$/gm, 'h3. $1');
                confluence = confluence.replace(/^##\s+(.+)$/gm, 'h2. $1');
                confluence = confluence.replace(/^#\s+(.+)$/gm, 'h1. $1');

                confluence = confluence.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                    return lang ? `{code:${lang}}\n${code}{code}` : `{code}\n${code}{code}`;
                });

                confluence = confluence.replace(/`([^`]+)`/g, '{{$1}}');

                confluence = confluence.replace(/\*\*(.+?)\*\*/g, '*$1*');
                confluence = confluence.replace(/__(.+?)__/g, '*$1*');

                confluence = confluence.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '_$1_');

                confluence = confluence.replace(/~~(.+?)~~/g, '-$1-');

                confluence = confluence.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '[$1|$2]');

                confluence = confluence.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '!$2|alt=$1!');

                confluence = confluence.replace(/^\*\s+/gm, '* ');
                confluence = confluence.replace(/^-\s+/gm, '* ');

                confluence = confluence.replace(/^\d+\.\s+/gm, '# ');

                confluence = confluence.replace(/^>\s+(.+)$/gm, '{quote}$1{quote}');

                confluence = confluence.replace(/^---+$/gm, '----');
                confluence = confluence.replace(/^\*\*\*+$/gm, '----');

                return confluence;
            };

            const confluenceToHtml = (confluence) => {
                let html = confluence;

                html = html.replace(/^h1\.\s+(.+)$/gm, '<h1>$1</h1>');
                html = html.replace(/^h2\.\s+(.+)$/gm, '<h2>$1</h2>');
                html = html.replace(/^h3\.\s+(.+)$/gm, '<h3>$1</h3>');
                html = html.replace(/^h4\.\s+(.+)$/gm, '<h4>$1</h4>');
                html = html.replace(/^h5\.\s+(.+)$/gm, '<h5>$1</h5>');
                html = html.replace(/^h6\.\s+(.+)$/gm, '<h6>$1</h6>');

                html = html.replace(/\{code:(\w+)\}\n([\s\S]*?)\{code\}/g, '<pre><code>$2</code></pre>');
                html = html.replace(/\{code\}\n([\s\S]*?)\{code\}/g, '<pre><code>$1</code></pre>');

                html = html.replace(/\{\{([^}]+)\}\}/g, '<code>$1</code>');

                html = html.replace(/\*(.+?)\*/g, '<strong>$1</strong>');

                html = html.replace(/_(.+?)_/g, '<em>$1</em>');

                html = html.replace(/-(.+?)-/g, '<del>$1</del>');

                html = html.replace(/\[([^\]|]+)\|([^\]]+)\]/g, '<a href="$2">$1</a>');

                html = html.replace(/!([^|!]+)\|alt=([^!]*)!/g, '<img src="$1" alt="$2" />');
                html = html.replace(/!([^!]+)!/g, '<img src="$1" />');

                const lines = html.split('\n');
                let inList = false;
                let listType = null;
                let result = [];

                for (let line of lines) {
                    if (line.match(/^\*\s+/)) {
                        if (!inList || listType !== 'ul') {
                            if (inList) result.push(listType === 'ol' ? '</ol>' : '</ul>');
                            result.push('<ul>');
                            inList = true;
                            listType = 'ul';
                        }
                        result.push('<li>' + line.replace(/^\*\s+/, '') + '</li>');
                    } else if (line.match(/^#\s+/)) {
                        if (!inList || listType !== 'ol') {
                            if (inList) result.push(listType === 'ol' ? '</ol>' : '</ul>');
                            result.push('<ol>');
                            inList = true;
                            listType = 'ol';
                        }
                        result.push('<li>' + line.replace(/^#\s+/, '') + '</li>');
                    } else {
                        if (inList) {
                            result.push(listType === 'ol' ? '</ol>' : '</ul>');
                            inList = false;
                            listType = null;
                        }
                        result.push(line);
                    }
                }
                if (inList) {
                    result.push(listType === 'ol' ? '</ol>' : '</ul>');
                }
                html = result.join('\n');

                html = html.replace(/\{quote\}(.+?)\{quote\}/g, '<blockquote>$1</blockquote>');

                html = html.replace(/^----$/gm, '<hr />');

                html = html.replace(/\n\n/g, '</p><p>');
                html = '<p>' + html + '</p>';

                return html;
            };

            const currentMarkdown = inputMode === 'files' && selectedFileIndex !== null 
                ? files[selectedFileIndex]?.content || '' 
                : markdown;

            const confluenceMarkup = useMemo(() => convertToConfluence(currentMarkdown), [currentMarkdown]);
            const htmlPreview = useMemo(() => confluenceToHtml(confluenceMarkup), [confluenceMarkup]);

            const handleFileUpload = async (uploadedFiles) => {
                const newFiles = [];
                for (let file of uploadedFiles) {
                    if (file.name.endsWith('.md') || file.name.endsWith('.markdown') || file.type === 'text/markdown') {
                        const content = await file.text();
                        newFiles.push({
                            name: file.name,
                            content: content,
                            confluence: convertToConfluence(content)
                        });
                    }
                }
                setFiles(prev => [...prev, ...newFiles]);
                if (newFiles.length > 0 && selectedFileIndex === null) {
                    setSelectedFileIndex(files.length);
                }
            };

            const handleFileInputChange = (e) => {
                handleFileUpload(Array.from(e.target.files));
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                handleFileUpload(Array.from(e.dataTransfer.files));
            };

            const handleRemoveFile = (index) => {
                setFiles(prev => prev.filter((_, i) => i !== index));
                if (selectedFileIndex === index) {
                    setSelectedFileIndex(files.length > 1 ? 0 : null);
                } else if (selectedFileIndex > index) {
                    setSelectedFileIndex(selectedFileIndex - 1);
                }
            };

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(confluenceMarkup);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            };

            const handleDownloadAll = () => {
                files.forEach(file => {
                    const blob = new Blob([file.confluence], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name.replace(/\.md$/, '_confluence.txt');
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };

            const handleClear = () => {
                if (inputMode === 'text') {
                    setMarkdown('');
                } else {
                    setFiles([]);
                    setSelectedFileIndex(null);
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>Markdown ‚Üí Confluence Â§âÊèõ„ÉÑ„Éº„É´</h1>
                        <p>Markdown„ÇíÂÖ•Âäõ„Åæ„Åü„ÅØ„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Å®„ÄÅConfluenceË®òÊ≥ï„Å´Â§âÊèõ„Åï„Çå„Åæ„Åô</p>
                    </div>

                    <div className="main-content">
                        <div className="panel panel-left">
                            <div className="panel-header">
                                <div className="tab-buttons">
                                    <button
                                        onClick={() => setInputMode('text')}
                                        className={`button button-mode ${inputMode === 'text' ? 'active' : ''}`}
                                    >
                                        ‚úèÔ∏è „ÉÜ„Ç≠„Çπ„ÉàÂÖ•Âäõ
                                    </button>
                                    <button
                                        onClick={() => setInputMode('files')}
                                        className={`button button-mode ${inputMode === 'files' ? 'active' : ''}`}
                                    >
                                        üìÅ „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                                    </button>
                                </div>
                                <button onClick={handleClear} className="button button-clear">
                                    ‚úï „ÇØ„É™„Ç¢
                                </button>
                            </div>

                            <div className="input-area">
                                {inputMode === 'text' ? (
                                    <textarea
                                        value={markdown}
                                        onChange={(e) => setMarkdown(e.target.value)}
                                        placeholder="„Åì„Åì„Å´Markdown„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...

‰æã:
# Ë¶ãÂá∫„Åó1
## Ë¶ãÂá∫„Åó2

**Â§™Â≠ó** „Å® *Êñú‰Ωì*

- „É™„Çπ„ÉàÈ†ÖÁõÆ1
- „É™„Çπ„ÉàÈ†ÖÁõÆ2

```javascript
const code = 'example';
```"
                                    />
                                ) : (
                                    <>
                                        <div className="upload-section">
                                            <div
                                                className={`upload-area ${dragOver ? 'drag-over' : ''}`}
                                                onClick={() => fileInputRef.current?.click()}
                                                onDragOver={handleDragOver}
                                                onDragLeave={handleDragLeave}
                                                onDrop={handleDrop}
                                            >
                                                <div className="upload-icon">üì§</div>
                                                <div className="upload-text">
                                                    „ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åß<br />
                                                    Markdown„Éï„Ç°„Ç§„É´(.md)„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                                                </div>
                                            </div>
                                            <input
                                                ref={fileInputRef}
                                                type="file"
                                                className="file-input"
                                                accept=".md,.markdown"
                                                multiple
                                                onChange={handleFileInputChange}
                                            />
                                            {files.length > 0 && (
                                                <div className="file-list">
                                                    {files.map((file, index) => (
                                                        <div
                                                            key={index}
                                                            className={`file-item ${selectedFileIndex === index ? 'selected' : ''}`}
                                                        >
                                                            <div
                                                                className="file-name"
                                                                onClick={() => setSelectedFileIndex(index)}
                                                            >
                                                                üìÑ {file.name}
                                                            </div>
                                                            <button
                                                                className="file-remove"
                                                                onClick={() => handleRemoveFile(index)}
                                                            >
                                                                ÂâäÈô§
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        {selectedFileIndex !== null && (
                                            <textarea
                                                value={files[selectedFileIndex]?.content || ''}
                                                readOnly
                                                style={{ background: '#f9fafb' }}
                                            />
                                        )}
                                    </>
                                )}
                            </div>
                        </div>

                        <div className="panel">
                            <div className="panel-header">
                                <div className="mode-buttons">
                                    <button
                                        onClick={() => setViewMode('source')}
                                        className={`button button-mode ${viewMode === 'source' ? 'active' : ''}`}
                                    >
                                        üìÑ „ÇΩ„Éº„Çπ„É¢„Éº„Éâ
                                    </button>
                                    <button
                                        onClick={() => setViewMode('preview')}
                                        className={`button button-mode ${viewMode === 'preview' ? 'active' : ''}`}
                                    >
                                        üëÅ „Éó„É¨„Éì„É•„Éº„É¢„Éº„Éâ
                                    </button>
                                </div>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    {inputMode === 'files' && files.length > 0 && (
                                        <button onClick={handleDownloadAll} className="button download-all">
                                            üíæ ÂÖ®„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                                        </button>
                                    )}
                                    <button onClick={handleCopy} className="button button-primary">
                                        üìã {copied ? '„Ç≥„Éî„ÉºÂÆå‰∫Ü!' : '„Ç≥„Éî„Éº'}
                                    </button>
                                </div>
                            </div>

                            <div className="output-area">
                                {viewMode === 'source' ? (
                                    <div className="output-source">
                                        {confluenceMarkup || <span className="placeholder">Â§âÊèõÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...</span>}
                                    </div>
                                ) : (
                                    <div 
                                        className="output-preview"
                                        dangerouslySetInnerHTML={{
                                            __html: confluenceMarkup
                                                ? htmlPreview
                                                : '<p class="placeholder">„Éó„É¨„Éì„É•„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...</p>',
                                        }}
                                    />
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MarkdownToConfluence />, document.getElementById('root'));
    </script>
</body>
</html>
